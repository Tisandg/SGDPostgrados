<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:p="http://primefaces.org/ui"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets" >


    <h:head>
        <title>Registrar publicacion</title>
    </h:head>             

    <ui:composition template="../../../plantillas/Estudiante.xhtml">
        <ui:define name="content">
            <div class="ui-messages-info ">
                <span class="ui-messages-info-detail">                     
                    <p:commandButton actionListener="#{publicacionController.redirigirARegistrar(userLoginView.username)}" value="publicación"/>&nbsp;
                    <p:commandButton actionListener="#{publicacionController.redirigirALibro(userLoginView.username)}" value="Libro"/>&nbsp;
                    <p:commandButton actionListener="#{practicaDocenteController.redirigirARegistrar(userLoginView.username)}" value="Practica docente"/>
                </span>
            </div>             

            <h:form id="form_registrar" enctype="multipart/form-data">   
                <p:panel header="Datos Libro">
                    <div style = "float: right;">
                        <p:outputLabel style="font-weight:bold; " value="Campos obligatorios"/>
                        <p:outputLabel style="font-style: italic; font-size: 16px; text-align: left; color: red;"  value="* " />
                    </div>
                    <h:panelGrid columns="3" cellpadding="5">
                        <p:outputLabel value="Nombre autor:" styleClass="addEspacio"/>
                        <h:outputText class="form-control" id="valNombreAutor"  value="#{publicacionController.getnombreAut()}" style="color: #3366ff"></h:outputText>
                        <p:outputLabel value="" styleClass="addEspacio"/>


                        <p:outputLabel value="Autores secundarios:" styleClass="addEspacio"/>
                        <p:inputText value="#{publicacionController.nombreAutor}" id="autor" placeholder="Ingrese nombre autor aquí" size="35">
                            <f:validator validatorId="validadorAutoresSecundarios" />
                            <p:ajax event="blur" update="msjValAutores" /> 
                        </p:inputText>
                        <p:commandButton id="agregarAutor" icon="ui-icon-plus">
                            <p:ajax event="click" listener="#{publicacionController.agregarAutorSecundario()}" update="autor, tablaAutores"/>
                        </p:commandButton>

                        <p:outputLabel value="" styleClass="addEspacio"/>
                        <p:message for="autor" id="msjValAutores" />
                        <p:outputLabel value="" styleClass="addEspacio"/>
                        <p:outputLabel value="" styleClass="addEspacio"/>

                        <p:dataTable id ="tablaAutores" value="#{publicacionController.listaAutores}" var="autor" 
                                     style="width:302px;" emptyMessage="" rendered="true">
                            <p:column width="180">
                                <p:outputLabel value="#{autor.nombre}" id="nombreAutor"/>                                
                            </p:column>                            
                            <p:column  class="gridsinbordes" width="22">
                                <p:commandButton id="eliminarNombreAutor" icon="ui-icon-close">
                                    <f:ajax event="click" listener="#{publicacionController.eliminarAutorSecundario(autor.nombre)}" 
                                            render="tablaAutores" />                                    
                                </p:commandButton>
                            </p:column>                                                            
                        </p:dataTable>   

                        <!--
                        <p:outputLabel value="Autores Secundarios:" for="valASecundarios" styleClass="addEspacio"/>
                        <p:inputText class="form-control" id="valASecundarios"  value="#//{publicacionController.actual.pubAutoresSecundarios}" styleClass="addEspacio form-control">
                            <f:validator validatorId="validadorAutoresSecundarios" />
                            <p:ajax event="blur" update="msjValAutores" /> 
                        </p:inputText>
                        <p:message for="valASecundarios" id="msjValAutores" />-->


                        <p:outputLabel value="Fecha publicación:" styleClass="addEspacio"/>
                        <p:calendar  id="event" value="#{publicacionController.actual.pubFechaPublicacion}" maxdate="#{currentDay}" size="35" 
                                     pattern="yyyy-MMM-dd" navigator="true" autocomplete="false" locale="es">
                            <p:ajax event="dateSelect" listener="#{publicacionController.onDateSelect}"  />
                            <f:validator validatorId="validadorFechaPublicacion" />
                            <p:ajax event="blur" update="msjValFechaPublicacion" />
                        </p:calendar>
                        <p:message for="event" id="msjValFechaPublicacion" />

                    </h:panelGrid>

                    <br/>
                    <h:panelGrid columns="5" cellpadding="5">
                        <h:panelGroup>
                            <p:outputLabel value="ISBN:" styleClass="addEspacio"/>
                            <p:outputLabel style="font-style: italic; font-size: 16px; text-align: left; color: red;"  value="*" />
                        </h:panelGroup>
                        <p:inputText class="form-control" id="valISBNLibro"  value="#{publicacionController.pubIsbn}" 
                                     styleClass="addEspacio form-control" placeholder="123-12-12345-12-1" size="35">
                            <f:validator validatorId="validadorISBN" /> 
                            <p:ajax event="blur" update="msjValISBNLibro" />
                        </p:inputText>
                        <p:message for="valISBNLibro" id="msjValISBNLibro" /> 
                        <h:outputLink style="color: blue" value="https://goo.gl/jQFjlJ">Conozca más sobre el ISBN</h:outputLink>
                        <h:outputLink style="color: blue" value="https://goo.gl/DQUANK">Verifique su ISBN</h:outputLink>

                        <h:panelGroup>
                            <p:outputLabel value="Título libro:" styleClass="addEspacio"/>
                            <p:outputLabel style="font-style: italic; font-size: 16px; text-align: left; color: red;"  value="*" />
                        </h:panelGroup>
                        <p:inputText class="form-control" id="valTLibro"  value="#{publicacionController.actual.libro.libTituloLibro}" placeholder="Ingrese título aquí" size="35">
                            <f:validator validatorId="validadorTituloLibro" />
                            <p:ajax event="blur" update="msjvalTLibro" />
                        </p:inputText>
                        <p:message for="valTLibro" id="msjvalTLibro" />
                        <p:outputLabel value=""></p:outputLabel>
                        <p:outputLabel value=""></p:outputLabel>

                        <h:panelGroup>
                            <p:outputLabel value="Editorial:" styleClass="addEspacio"/>
                            <p:outputLabel style="font-style: italic; font-size: 16px; text-align: left; color: red;"  value="*" />
                        </h:panelGroup>
                        <p:inputText class="form-control" id="valELibro" value="#{publicacionController.actual.libro.editorial}" size="35">
                            <f:validator validatorId="validadorEditorialLibro"/>
                            <p:ajax event="blur" update="msjvalELibro"/>
                        </p:inputText>
                        <p:message for="valELibro" id="msjvalELibro" />
                        <p:outputLabel value=""></p:outputLabel>
                        <h:outputText value=""/>
                        
                        <h:panelGroup>
                            <p:outputLabel value="País:" styleClass="addEspacio"/>
                            <p:outputLabel style="font-style: italic; font-size: 16px; text-align: left; color: red;"  value="*" />
                        </h:panelGroup>
                        <p:selectOneMenu filter="true"
                                         id="pais"
                                         value="#{publicacionController.idPais}">
                            <f:selectItem itemLabel="Seleccione..." itemValue="0"/>
                            <f:selectItems value="#{publicacionController.listaPaises}"
                                           var="paisItem"
                                           itemValue="#{paisItem.paisId}"
                                           itemLabel="#{paisItem.paisNombre}"/>
                            <p:ajax listener="#{publicacionController.actualizarCiudades()}" update="ciudad" />
                        </p:selectOneMenu>
                        <h:outputText value=""/>
                        <h:outputText value=""/>
                        <h:outputText value=""/>
                        
                        <h:panelGroup>
                            <p:outputLabel value="Ciudad:" styleClass="addEspacio"/>
                            <p:outputLabel style="font-style: italic; font-size: 16px; text-align: left; color: red;"  value="*" />
                        </h:panelGroup>
                        <p:selectOneMenu filter="true"
                                         id="ciudad"
                                         value="#{publicacionController.idCiudad}">
                            <f:selectItem itemLabel="Seleccione..." itemValue="0"/>
                            <f:selectItems value="#{publicacionController.listaCiudades}"
                                           var="ciudadItem"
                                           itemValue="#{ciudadItem.ciudId}"
                                           itemLabel="#{ciudadItem.ciudNombre}"/>
                        </p:selectOneMenu>
                        <h:outputText value=""/>
                        <h:outputText value=""/>
                        <h:outputText value=""/>

                        <h:panelGroup>
                            <p:outputLabel value="Libro PDF:"/>
                            <p:outputLabel style="font-style: italic; font-size: 16px; text-align: left; color: red;"  value="*" />&nbsp;
                        </h:panelGroup>
                        <p:fileUpload id="libroPDF" value="#{publicacionController.publicacionPDF}" required="true" mode="simple" allowTypes="/(\.|\/)(pdf)$/" />                                 
                    </h:panelGrid>
                    <br/>

                </p:panel>

                <br></br>

                <p:messages for="valPublicacion"  id="msjPublicacionF"/>
                <h:panelGrid columns="4">                        
                    <h:outputLabel value="Tabla de contenido PDF:" styleClass="addEspacio"/>
                    <p:fileUpload id="tablaContenidoPDF"   value="#{publicacionController.tablaContenidoPDF}" required="true" mode="simple" allowTypes="/(\.|\/)(pdf)$/" styleClass="addEspacio"/>                        
                    <p:messages for="valTContenido"  id="msjvalTContenido" />
                    <h:outputText value=""/>

                    <h:panelGroup>
                        <p:outputLabel value="Evidencia de publicación:" />
                        <p:outputLabel style="font-style: italic; font-size: 16px; text-align: left; color: red;"  value="*" />&nbsp;
                    </h:panelGroup>
                    <h:panelGroup>                            
                        <p:fileUpload id="cartaAprobacionPDF" styleClass="btn btn-primary" value="#{publicacionController.cartaAprobacionPDF}" required="true" mode="simple" allowTypes="/(\.|\/)(pdf)$/" />&rlm;&ensp;
                        <p:commandButton id="ayuda" ajax="false" onclick="return false;"  icon="ui-icon-help"/>
                        <p:tooltip id="toolTipGrow" for="ayuda" value="En este campo se debe seleccionar la carta de aprobación de la publicación"
                                   showEffect="clip" hideEffect="blind" />&nbsp;&nbsp;                            
                    </h:panelGroup>

                    <p:messages for="cartaAprobacion"  id="msjCartaAprobacion"/>
                </h:panelGrid>
                
                <h:form>
                    <h:panelGrid columns="2" cellspacing="10>">
                        <h:commandButton value="Registrar" action="#{publicacionController.agregar('libro')}"/>
                        <h:commandButton value="Cancelar" onclick="if (!confirm('¿Desea cancelar el registro de la publicación?')) {
                                return false;
                            }
                            ;
                            return true;" action="#{publicacionController.redirigirAlistar(userLoginView.username)}" class="btn btn-primary" immediate="true"/>
                    </h:panelGrid>
                </h:form>
                <br/>
            </h:form>      

        </ui:define>
    </ui:composition>
</html>  